/*!
 * jQCloud Plugin for jQuery
 *
 * Version 1.0.4
 *
 * Copyright 2011, Luca Ongaro
 * Licensed under the MIT license.
 *
 * Date: 2013-11-13 20:30:34 -0500
*/
!function(t){"use strict";var e=function(e,i,s){this.$element=t(e),this.word_array=i||[],this.options=s,this.timeouts,this.cloud_namespace,this.already_placed_words,this.step,this.aspect_ratio,this.initialize()};e.prototype={initialize:function(){var e={width:this.$element.width(),height:this.$element.height(),center:{x:(this.options&&this.options.width?this.options.width:this.$element.width())/2,y:(this.options&&this.options.height?this.options.height:this.$element.height())/2},delayedMode:this.word_array.length>50,shape:!1,encodeURI:!0,removeOverflowing:!0};return this.options=t.extend({},e,this.options),this.timeouts={},this.step="rectangular"===this.options.shape?18:2,this.aspect_ratio=this.options.width/this.options.height,this.already_placed_words=[],this.cloud_namespace=(this.$element.attr("id")||Math.floor(1e6*Math.random()).toString(36))+"_word_",this.$element.addClass("jqcloud").width(this.options.width).height(this.options.height),"static"===this.$element.css("position")&&this.$element.css("position","relative"),this.createTimeout(t.proxy(function(){this.drawWordCloud()},this),10),this.$element},overlapping:function(t,e){return Math.abs(2*t.offsetLeft+t.offsetWidth-2*e.offsetLeft-e.offsetWidth)<t.offsetWidth+e.offsetWidth&&Math.abs(2*t.offsetTop+t.offsetHeight-2*e.offsetTop-e.offsetHeight)<t.offsetHeight+e.offsetHeight?!0:!1},createTimeout:function(e,i){var s=setTimeout(t.proxy(function(){delete this.timeouts[s],e()},this),i);this.timeouts[s]=!0},hitTest:function(t,e){for(var i=0;i<e.length;i++)if(this.overlapping(t,e[i]))return!0;return!1},drawWordCloud:function(){for(var e=0;e<this.word_array.length;e++)this.word_array[e].weight=parseFloat(this.word_array[e].weight,10);this.word_array.sort(function(t,e){return t.weight<e.weight?1:t.weight>e.weight?-1:0}),this.options.delayedMode?this.drawOneWordDelayed():(t.each(this.word_array,t.proxy(this.drawOneWord,this)),t.isFunction(this.options.afterCloudRender)&&this.options.afterCloudRender.call(this.$element))},drawOneWord:function(e,i){var s,o=this.cloud_namespace+e,h=6.28*Math.random(),r=0,a=0,n=0,d=5,l="",p="";if(i.html=t.extend(i.html,{id:o}),i.html&&i.html["class"]&&(l=i.html["class"],delete i.html["class"]),this.word_array[0].weight>this.word_array[this.word_array.length-1].weight&&(d=Math.round(9*((i.weight-this.word_array[this.word_array.length-1].weight)/(this.word_array[0].weight-this.word_array[this.word_array.length-1].weight)))+1),s=t("<span>").attr(i.html).addClass("w"+d+" "+l),i.link?("string"==typeof i.link&&(i.link={href:i.link}),this.options.encodeURI&&(i.link=t.extend(i.link,{href:encodeURI(i.link.href).replace(/'/g,"%27")})),p=t("<a>").attr(i.link).text(i.text)):p=i.text,s.append(p),i.handlers)for(var c in i.handlers)i.handlers.hasOwnProperty(c)&&"function"==typeof i.handlers[c]&&t(s).bind(c,i.handlers[c]);this.$element.append(s);var f=s.width(),u=s.height(),w=this.options.center.x-f/2,m=this.options.center.y-u/2,y=s[0].style;for(y.position="absolute",y.left=w+"px",y.top=m+"px";this.hitTest(s[0],this.already_placed_words);){if("rectangular"===this.options.shape)switch(a++,a*this.step>(1+Math.floor(n/2))*this.step*(0===n%4%2?1:this.aspect_ratio)&&(a=0,n++),n%4){case 1:w+=this.step*this.aspect_ratio+2*Math.random();break;case 2:m-=this.step+2*Math.random();break;case 3:w-=this.step*this.aspect_ratio+2*Math.random();break;case 0:m+=this.step+2*Math.random()}else r+=this.step,h+=(0===e%2?1:-1)*this.step,w=this.options.center.x-f/2+r*Math.cos(h)*this.aspect_ratio,m=this.options.center.y+r*Math.sin(h)-u/2;y.left=w+"px",y.top=m+"px"}return this.options.removeOverflowing&&(0>w||0>m||w+f>this.options.width||m+u>this.options.height)?(s.remove(),void 0):(this.already_placed_words.push(s[0]),t.isFunction(i.afterWordRender)&&i.afterWordRender.call(s),void 0)},drawOneWordDelayed:function(e){return e=e||0,this.$element.is(":visible")?(e<this.word_array.length?(this.drawOneWord(e,this.word_array[e]),this.createTimeout(t.proxy(function(){this.drawOneWordDelayed(e+1)},this),10)):t.isFunction(this.options.afterCloudRender)&&this.options.afterCloudRender.call(this.$element),void 0):(this.createTimeout(t.proxy(function(){this.drawOneWordDelayed(e)},this),10),void 0)},destroy:function(){t.each(this.timeouts,function(t){clearTimeout(t)}),this.$element.removeClass("jqcloud"),this.$element.removeData("jqcloud"),this.$element.children('[id^="'+this.cloud_namespace+'"]').remove()}},t.fn.jQCloud=function(i,s){var o=arguments,h="jqcloud";return this.each(function(){var r=t(this),a=r.data(h),n="object"==typeof s&&s;a||r.data(h,a=new e(this,i,n)),"string"==typeof i&&a[i].apply(a,Array.prototype.slice.call(o,1))})}}(jQuery);